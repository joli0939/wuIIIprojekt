document.addEventListener("DOMContentLoaded",function(){var n="http://studenter.miun.se/~joli0939/dt173G/projekt/rest.php/books",u=new(function(){function e(e){this.url=e}return e.prototype.insertPOST=function(e){var t=new XMLHttpRequest,n={title:e.title,author:e.author,genre:e.genre,isbn:e.isbn,pages:e.pages,user:e.user};t.open("POST",this.url,!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(n)),t.onload=function(){location.reload()},document.getElementById("title").value="",document.getElementById("author").value="",document.getElementById("genre").value="",document.getElementById("isbn").value="",document.getElementById("pages").value=""},e.prototype.insertPUT=function(e){var t=new XMLHttpRequest,n={title:e.title,author:e.author,genre:e.genre,isbn:e.isbn,pages:e.pages};t.open("PUT",this.url+"/"+e.id,!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(n)),t.onload=function(){location.reload()}},e.prototype.deletePost=function(e){var t=new XMLHttpRequest;t.open("DELETE",n+"/"+e,!0),t.send(),t.onload=function(){location.reload()}},e}())(n);function x(){var e=l(this.id),t=document.getElementById("edittitle"+e).value,n=document.getElementById("editauthor"+e).value,i=document.getElementById("editgenre"+e).value,a=document.getElementById("editisbn"+e).value,d=document.getElementById("editpages"+e).value;if(""==t||""==n||""==i||""==a||""==d)document.getElementById("editErrormsg"+e).innerHTML="Ett eller flera av fälten är inte ifyllda";else if(isNaN(parseInt(document.getElementById("editpages"+e).value)))document.getElementById("editErrormsg"+e).innerHTML="'Antal sidor' måste vara en siffra";else{var r={id:e,title:t,author:n,genre:i,isbn:a,pages:parseInt(d)};u.insertPUT(r)}}function O(){var e=l(this.id);u.deletePost(e)}function w(){var e=l(this.id),t=document.getElementById("edit"+e);document.getElementById("divedit"+e).classList.toggle("showEdit"),"Ändra"==t.value?t.value="Dölj":t.value="Ändra"}function l(e){return e.match(/\d+/g)[0]}document.getElementById("addbutton").addEventListener("click",function(){var e=document.getElementById("title").value,t=document.getElementById("author").value,n=document.getElementById("genre").value,i=document.getElementById("isbn").value,a=document.getElementById("pages").value;if(""==e||""==t||""==n||""==i||""==a)document.getElementById("addnewErrormsg").innerHTML="Ett eller flera av fälten är inte ifyllda";else if(isNaN(parseInt(document.getElementById("pages").value)))document.getElementById("addnewErrormsg").innerHTML="'Antal sidor' måste vara en siffra";else{var d={title:e,author:t,genre:n,isbn:i,pages:parseInt(a),user:document.getElementById("booksusername").innerHTML};u.insertPOST(d)}});var S=new XMLHttpRequest;S.onreadystatechange=function(){if(S.readyState==XMLHttpRequest.DONE)if(200==S.status){console.log("Status 200");for(var e=JSON.parse(S.responseText),t=document.getElementById("booksusername").innerHTML,n=document.getElementById("booklist"),i=0,a=0;a<e.length;a++)e[a].user==t&&(i+=1);if(0!=i){for(var d=0;d<e.length;d++)if(e[d].user==t){var r=document.createElement("div");r.setAttribute("class","showbooks");var u=document.createElement("p"),l=document.createTextNode("Titel: "+e[d].title);u.appendChild(l),r.appendChild(u);var s=document.createElement("p"),o=document.createTextNode("Författare: "+e[d].author);s.appendChild(o),r.appendChild(s);var c=document.createElement("p"),p=document.createTextNode("Genre: "+e[d].genre);c.appendChild(p),r.appendChild(c);var m=document.createElement("p"),g=document.createTextNode("ISBN: "+e[d].isbn);m.appendChild(g),r.appendChild(m);var v=document.createElement("p"),b=document.createTextNode("Antal sidor: "+e[d].pages);v.appendChild(b),r.appendChild(v);var E=document.createElement("input");E.setAttribute("type","button"),E.setAttribute("value","Ändra"),E.setAttribute("id","edit"+e[d].ID),E.setAttribute("class","openChange button"),r.appendChild(E);var h=document.createElement("input");h.setAttribute("type","button"),h.setAttribute("value","Ta bort"),h.setAttribute("id","delete"+e[d].ID),h.setAttribute("class","deletebutton button"),r.appendChild(h);var y=document.createElement("div");y.setAttribute("class","hidden"),y.setAttribute("id","divedit"+e[d].ID);var f=document.createElement("input");f.setAttribute("type","text"),f.setAttribute("id","edittitle"+e[d].ID),f.setAttribute("class","editinput"),f.setAttribute("value",e[d].title),y.appendChild(f);var I=document.createElement("input");I.setAttribute("type","text"),I.setAttribute("id","editauthor"+e[d].ID),I.setAttribute("class","editinput"),I.setAttribute("value",e[d].author),y.appendChild(I);var A=document.createElement("input");A.setAttribute("type","text"),A.setAttribute("id","editgenre"+e[d].ID),A.setAttribute("class","editinput"),A.setAttribute("value",e[d].genre),y.appendChild(A);var B=document.createElement("input");B.setAttribute("type","text"),B.setAttribute("id","editisbn"+e[d].ID),B.setAttribute("class","editinput"),B.setAttribute("value",e[d].isbn),y.appendChild(B);var C=document.createElement("input");C.setAttribute("type","text"),C.setAttribute("id","editpages"+e[d].ID),C.setAttribute("class","editinput"),C.setAttribute("value",e[d].pages),y.appendChild(C);var T=document.createElement("p");T.setAttribute("id","editErrormsg"+e[d].ID),y.appendChild(T);var L=document.createElement("input");L.setAttribute("type","button"),L.setAttribute("id","confirmedit"+e[d].ID),L.setAttribute("class","confirmeditbtn button"),L.setAttribute("value","Bekräfta"),y.appendChild(L),r.appendChild(y),n.appendChild(r)}for(var N=document.getElementsByClassName("deletebutton"),D=0;D<N.length;D++)N[D].addEventListener("click",O);for(var k=document.getElementsByClassName("openChange"),H=0;H<k.length;H++)k[H].addEventListener("click",w);for(var M=document.getElementsByClassName("confirmeditbtn"),R=0;R<M.length;R++)M[R].addEventListener("click",x)}else n.innerHTML="<p class='noBooks'>Du har inte lagt till några böcker än, fyll i fälten i toppen på sidan för att börja lägga till dina böcker</p>"}else 400==S.status?alert("ERROR: 400"):alert("ERROR: Annat svar än 200 returnerades")},S.open("GET",n,!0),S.send()});